!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3-scale"),require("d3-collection"),require("d3-array")):"function"==typeof define&&define.amd?define(["exports","d3-scale","d3-collection","d3-array"],n):n(e.d3=e.d3||{},e.d3,e.d3,e.d3)}(this,function(e,n,r,t){"use strict";function i(){function e(){var i=s(f);i.forEach(function(e){a(e)}),c(i);for(var d={},p=i.length-1;p>-1;p--)for(var h=i[p],v=h.children.length-1;v>-1;v--){var y=h.children[v];if(h.level<y.level-1){h.children.splice(v,1),y.parents.splice(y.parents.indexOf(h),1);for(var E=h;E.level<y.level-1;){var I=E.level+1,N="LI::"+I+"::"+h.id+"->"+y.sib_group_id;d[N]||(d[N]={type:"link-intermediate",id:N,sib_group_id:N,level:I,children:[],parents:[E]},E.children.push(d[N]),i.push(d[N])),E=d[N]}E.children.push(y),y.parents.push(E)}}var x=o(i);l(x);var T=[0,_*(x.length-1)+b],O=n.scaleLinear().domain([0,x.length-1+b/_]).range(T),G=[Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY];x.forEach(function(e,n){O(n);e.forEach(function(e,n){e.sort_ypos<G[0]&&(G[0]=e.sort_ypos),e.sort_ypos>G[1]&&(G[1]=e.sort_ypos)})});var L=G[0];G=[G[0]-L,G[1]-L],(G[0]==Number.POSITIVE_INFINITY||isNaN(G[0]))&&(G[0]=-m),(G[1]==Number.NEGATIVE_INFINITY||isNaN(G[0]))&&(G[1]=m),x.forEach(function(e,n){var r=O(n);e.forEach(function(e,n){e.y=e.sort_ypos-L,delete e.sort_ypos,e.x=r})}),i=[].concat.apply([],x).filter(function(e){return"link-intermediate"!=e.type});var F=r.nest().key(function(e){return e.sib_group_id}).entries(i).reduce(function(e,n){var r=O(n.values[0].level-g/_)+b/2,i=t.mean(n.values,function(e){return e.y});return e[n.key]=[r,i],e},{}),P=u(5,.25,.75),S=r.values(i.reduce(function(e,n){for(var r=n.children.length-1;r>-1;r--){var t=n.children[r];if("link-intermediate"==t.type){n.children.splice(r,1);for(var i=t,o=n,u=[];"link-intermediate"==i.type;)u=u.concat(P(o.x+b,o.y,O(i.level-.5)+b/2,i.y,i.level)),o=i,i=i.children[0];o.children.forEach(function(r){n.children.push(r),r.parents.splice(r.parents.indexOf(o),1),r.parents.push(n);var t=u.concat(P(o.x+b,o.y,F[r.sib_group_id][0],F[r.sib_group_id][1],r.level));t.push(F[r.sib_group_id].slice()),c="LINK::"+n.id+"--\x3e--"+r.sib_group_id,e[c]?e[c].sinks.push(r):e[c]={source:n,sinks:[r],type:"parent->mid",id:c,path:t},l="LINK::parents--\x3e--"+r.id,e[l]?e[l].sources.push(n):e[l]={sources:[n],sink:r,type:"mid->child",id:l,path:[F[r.sib_group_id].slice(),[r.x,r.y]]}})}else{var c="LINK::"+n.id+"--\x3e--"+t.sib_group_id;if(e[c])e[c].sinks.push(t);else{var a=P(n.x+b,n.y,F[t.sib_group_id][0],F[t.sib_group_id][1],n.level+1);e[c]={source:n,sinks:[t],type:"parent->mid",id:c,path:a}}var l="LINK::parents--\x3e--"+t.id;e[l]?e[l].sources.push(n):e[l]={sources:[n],sink:t,type:"mid->child",id:l,path:[F[t.sib_group_id].slice(),[t.x,t.y]]}}}return e},{}));if(k){var K=T;T=G,G=K,S.forEach(function(e){e.path.forEach(function(e){var n=e[0];e[0]=e[1],e[1]=n})}),i.forEach(function(e){var n=e.x;e.x=e.y,e.y=n})}return{nodes:i,links:S,x:T,y:G,pdgtree:e}}function i(e,n){for(var r=e.length!=n.length,i=e.length<n.length?e.length:n.length,o=e.length>n.length?e:n,u=0;u<i&&e[u]==n[u];)u+=1;return u==i?r?o==e?1:-1:0:t.ascending(e[u],n[u])}function o(e){var n=[];return e.forEach(function(e){n[e.level]||(n[e.level]=[]),n[e.level].push(e)}),n}function u(e,n,r){return function(t,i,o,u,c){var a=Math.abs((u-i)/m),l=o-(o-t)*(1-r),s=t+(o-t)*n,f=s-l,d=f/2+l,p=a*e,h=p%(f/2)+d;return[[t,i],[h,i],[h,u],[o,u]]}}function c(e){e.filter(function(e){return 0==e.parents.filter(Boolean).length}).forEach(function(e){e.children.length>0&&(e.level=t.min(e.children,function(e){return e.level-1}))})}function a(e,n){e.level?n&&n>e.level&&(e.level=n,e.children.forEach(function(n){a(n,e.level+1)})):(e.level=n||0,e.children.forEach(function(n){a(n,e.level+1)}))}function l(e){var n=t.max(e,function(e){return(e.length+1)*m});e.forEach(function(e){e.forEach(function(r,t){r.sort_ypos=t/(e.length-1||.5)*n})});for(var o=0;o<(v||1);o++){if(0!=v)for(var u=e.length-1;u>-1;u--){!function(e){e.forEach(function(e,n){for(var r=e.parents.filter(Boolean),t=0,i=0;i<e.children.length;i++)t+=e.children[i].sort_ypos;for(var i=0;i<r.length;i++)t+=r[i].sort_ypos;if(0!=t){t/=e.children.length+r.length}e.sort_ypos=t})}(e[u]);var c=e[u],a=r.nest().key(function(e){return e.sib_group_id}).entries(c).reduce(function(e,n){return e[n.key]=t.mean(n.values,function(e){return e.sort_ypos}),e},{});c.sort(function(e,n){return i([a[e.sib_group_id],e.sib_group_id,"node-group"==e.type?1:0,e.sort_ypos,e.id],[a[n.sib_group_id],n.sib_group_id,"node-group"==n.type?1:0,n.sort_ypos,n.id])});for(var l=function(e,n){return void 0===e||void 0===n?0:e.type!=n.type?m/2:"link-intermediate"==e.type?y/2:m/2},s=0,f=[],d=0;d<c.length;d++){var p={lpad:l(c[d-1],c[d]),rpad:l(c[d],c[d+1]),ideal:c[d].sort_ypos};p.pos=s+p.lpad,s=p.pos+p.rpad,f.push(p)}for(var d=0;d<f.length;d++){var h=f.slice(d),_=h[0].ideal-h[0].pos;if(!(_<0)){var g=t.mean(h,function(e){return e.ideal-e.pos});if(g>0){var E=t.min([_,g]);h.forEach(function(e){e.pos+=E})}}}for(var d=0;d<f.length;d++){var b=f.slice(0);b.reverse();var h=b.slice(d),_=h[0].ideal-h[0].pos;if(!(_>0)){var g=t.mean(h,function(e){return e.ideal-e.pos});if(g<0){var E=t.max([_,g]);h.forEach(function(e){e.pos+=E})}}}c.forEach(function(e,n){e.sort_ypos=f[n].pos})}e.forEach(function(e){})}return e}function s(e){var n={},t=e.map(function(e){var r=h(e);return n[r]={type:"node",id:h(e),value:x(e),children:[],_node_data:e},n[r]});if(t.forEach(function(e){var r=I(e._node_data).map(h);delete e._node_data,N||r.sort(),e.sib_group_id=r.length>0?"S::"+r.join("++M++"):"S::_ROOT_",e.parents=r.map(function(e){return n[e]}),e.parents.forEach(function(n){n&&n.children.push(e)})}),p){var i=r.nest().key(function(e){return e.sib_group_id}).entries(t),o=i.reduce(function(e,n){var r=n.values.filter(function(e){return 0==e.children.length&&!d[e.id]});if(r.length>=E){var t="G::"+n.key;e[t]={type:"node-group",id:t,sib_group_id:n.key,value:r,children:[]},e[t].parents=r[0].parents.map(function(n){return n.children.push(e[t]),n}),n.values.forEach(function(n){(n.children.length>0||d[n.id])&&(e[n.id]=n)})}else n.values.forEach(function(n){e[n.id]=n});return e},{}),u=r.values(o);return u.forEach(function(e){"node"==e.type&&(e.children=e.children.filter(function(e){return!!o[e.id]}))}),u}return t}var f=[],d={},p=!1,h=function(e){return e.id},v=1,_=100,g=50,y=10,E=3,m=10,b=0,I=function(e){return e.parents},N=!0,x=function(e){return e},k=!1;return e.add=function(n){var r={};return f.forEach(function(e){r[h(e)]=!0}),[].push.apply(f,n.filter(function(e){return!r[h(e)]})),e},e.data=function(n){return f=n,e},e.excludeFromGrouping=function(n){return n.forEach(function(e){d[e]=!0}),e},e.groupChildless=function(n){return p=n,e},e.id=function(n){return h=n,e},e.iterations=function(n){return v=n,e},e.levelWidth=function(n){return _=n,e},e.levelMidpoint=function(n){return g=n,e},e.linkPadding=function(n){return y=n,e},e.minGroupSize=function(n){return E=n,e},e.nodePadding=function(n){return m=n,e},e.nodeWidth=function(n){return b=n,e},e.parents=function(n){return I=n,e},e.parentsOrdered=function(n){return N=n,e},e.resetGroups=function(){return d={},e},e.value=function(n){return x=n,e},e.vertical=function(n){return k=n,e},e}e.pedigreeTree=i,Object.defineProperty(e,"__esModule",{value:!0})});